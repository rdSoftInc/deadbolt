<!--
SPDX-License-Identifier: MIT

------------------------------------------------------------------------------
@file report.html.j2
@brief HTML report template for Deadbolt scan results.

This Jinja2 template renders the final Deadbolt security report. It consumes
scan metadata, normalized findings, and derived attack surface information
to produce a standalone, human-readable HTML report.

Template context variables:
- meta           : Run metadata (meta.json)
- domain         : Scan domain (web / android / ios)
- surface        : Non-vulnerability findings (attack surface)
- findings       : Severity-filtered vulnerability findings
- min_severity   : Minimum severity threshold applied

Author: Rolstan Robert D'souza
Date: 2026
------------------------------------------------------------------------------
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Deadbolt Report â€“ {{ meta.run_id }}</title>

  <!--
    Embedded stylesheet.
    The report is fully self-contained and requires no external assets.
  -->
  <style>
    :root {
      --bg-main: #121212;
      --bg-panel: #1e1e1e;
      --bg-table-header: #2a2a2a;
      --bg-row-alt: #181818;

      --border: #333;
      --text-main: #e0e0e0;
      --text-muted: #9e9e9e;

      --accent: #ff9800;
    }

    /* Severity color mapping */
    .sev-critical { color: #ff5252; font-weight: bold; }
    .sev-high     { color: #ff7043; font-weight: bold; }
    .sev-medium   { color: #ffb74d; font-weight: bold; }
    .sev-low      { color: #ffd54f; }
    .sev-info     { color: #9e9e9e; }

    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: var(--bg-main);
      color: var(--text-main);
    }

    h1, h2 {
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
      color: #ffffff;
    }

    h1 {
      font-size: 1.8em;
    }

    h2 {
      margin-top: 32px;
      font-size: 1.3em;
    }

    ul {
      background: var(--bg-panel);
      padding: 16px 24px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    li {
      margin: 6px 0;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 32px 0;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 16px;
      background: var(--bg-panel);
      border: 1px solid var(--border);
    }

    th, td {
      border: 1px solid var(--border);
      padding: 10px;
      vertical-align: top;
    }

    th {
      background: var(--bg-table-header);
      text-align: left;
      color: #ffffff;
      font-weight: bold;
    }

    tbody tr:nth-child(even) {
      background: var(--bg-row-alt);
    }

    .tool {
      font-weight: bold;
      color: var(--accent);
    }

    .mono {
      font-family: Consolas, Monaco, monospace;
      font-size: 0.9em;
      color: #d0d0d0;
      word-break: break-all;
    }

    p {
      color: var(--text-muted);
    }

    strong {
      color: #ffffff;
    }
  </style>
</head>

<body>

<!-- ========================================================= -->
<!-- Report Header                                             -->
<!-- ========================================================= -->

<h1>ðŸ”© Deadbolt Security Report</h1>

<p>
  <strong>Scan domain:</strong> {{ domain | upper }}
</p>

<!-- ========================================================= -->
<!-- Run Metadata                                               -->
<!-- ========================================================= -->

<h2>Run Metadata</h2>
<ul>
  <li><strong>Run ID:</strong> {{ meta.run_id }}</li>
  <li><strong>Started:</strong> {{ meta.started_at }}</li>
  <li><strong>Finished:</strong> {{ meta.finished_at }}</li>
  <li><strong>Targets file:</strong> {{ meta.targets_file }}</li>
  <li><strong>Deadbolt version:</strong> {{ meta.deadbolt_version }}</li>
</ul>

<!-- ========================================================= -->
<!-- Tools Executed                                             -->
<!-- ========================================================= -->

<h2>Tools Executed</h2>
<ul>
  {% for tool, info in meta.tools.items() %}
    <li>
      <strong>{{ tool }}</strong> â€“ {{ info.image }} ({{ info.version }})
    </li>
  {% endfor %}
</ul>

<hr/>

<!-- ========================================================= -->
<!-- Attack Surface                                             -->
<!-- ========================================================= -->

<h2>Discovered Attack Surface</h2>

<p>
  {{ surface | length }} assets, endpoints, or input vectors discovered.
</p>

<table>
  <thead>
    <tr>
      <th>Asset</th>
      <th>Type</th>
      <th>Source Tool</th>
      <th>Status</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    {% for f in surface %}
    <tr>
      <td class="mono">{{ f.asset }}</td>
      <td>{{ f.kind }}</td>
      <td class="tool">{{ f.tool }}</td>
      <td>{{ f.status_code or "â€”" }}</td>
      <td class="mono">
        {% if f.metadata %}
          {% for k, v in f.metadata.items() %}
            <strong>{{ k }}:</strong> {{ v }}<br/>
          {% endfor %}
        {% else %}
          â€”
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr/>

<!-- ========================================================= -->
<!-- Vulnerabilities                                           -->
<!-- ========================================================= -->

<h2>Vulnerabilities</h2>

<p>
  Showing findings with severity
  <strong>{{ min_severity | upper }}</strong> and above.
</p>

<p>
  {{ findings | length }} vulnerabilities reported.
</p>

<table>
  <thead>
    <tr>
      <th>Asset</th>
      <th>Title</th>
      <th>Tool</th>
      <th>Severity</th>
      <th>Status</th>
      <th>Technologies</th>
      <th>CDN</th>
      <th>Details</th>
      <th>Evidence</th>
    </tr>
  </thead>
  <tbody>
    {% for f in findings %}
    <tr>
      <td class="mono">{{ f.asset }}</td>
      <td>{{ f.title }}</td>
      <td class="tool">{{ f.tool }}</td>
      <td>
        {% if f.severity %}
          <span class="sev-{{ f.severity }}">
            {{ f.severity | upper }}
          </span>
        {% else %}
          â€”
        {% endif %}
      </td>
      <td>{{ f.status_code or "â€”" }}</td>
      <td>
        {% if f.technologies %}
          {{ f.technologies | join(", ") }}
        {% else %}
          â€”
        {% endif %}
      </td>
      <td>{{ f.cdn_name or "â€”" }}</td>
      <td class="mono">
        {% if f.metadata %}
          {% for k, v in f.metadata.items() %}
            <strong>{{ k }}:</strong> {{ v }}<br/>
          {% endfor %}
        {% else %}
          â€”
        {% endif %}
      </td>
      <td class="mono">{{ f.evidence_path }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

</body>
</html>